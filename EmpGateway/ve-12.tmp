Imports System.Data
Imports System.Data.SqlClient
Partial Class Office
    Inherits System.Web.UI.Page
    Dim Obj As Connection = New Connection
    Dim SqlPass As String
    Dim i, length As Integer
    Dim formname As String
    Dim ext As String
    Dim J As Integer


    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        Response.Cache.SetCacheability(HttpCacheability.NoCache)
        If (Session("empcode").ToString <> "") Then

        Else
            Response.Redirect("login.aspx")
        End If

        If Page.IsPostBack Then
            length = Len(DDL1.Text)
            BindData()
        End If
    End Sub

    Public Sub BindData()

        Dim SqlPass = " Select FileName,FileExt from  jct_empg_Order a where a.deptcode='" & Trim(Mid(DDL1.Text, 1, 4)) & "'"
        Dim Dr As SqlDataReader = Obj.FetchReader(SqlPass)

        Try
            If Dr.HasRows = True Then
                J = 1
                While Dr.Read()
                    formname = Dr.Item("FileName")
                    Dim hyper As New HyperLink
                    hyper.Text = J & ". " + Dr.Item("FileName") + "<BR>"
                    ext = Dr.Item("Fileext")
                    hyper.NavigateUrl = "Downloadfile.aspx?filepth=D:\WebApplications\EmpGateway\Order\" & formname & ext
                    Me.BothBox.Controls.Add(hyper)
                    J = J + 1
                End While
                Dr.Close()

            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            Obj.ConClose()
        End Try

    End Sub
    Public Sub DDL1BindData()

        Dim SqlPass = "SELECT distinct a.DEPTCODE + ' - ' + b.DEPTNAME AS 'deptname' from jct_empg_forms a , DEPTMAST b where a.deptcode=b.deptcode"
        Dim Dr As SqlDataReader = Obj.FetchReader(SqlPass)
        Try
            If Dr.HasRows = True Then
                'Commented by Jagdeep 17Feb2009
                'i = 0
                'While Dr.Read()
                '    DDL1.Items(i).Text = Dr.Item("Deptname")
                '    i = i + 1
                'End While





                Dr.Close()
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            Obj.ConClose()
        End Try
    End Sub

End Class



